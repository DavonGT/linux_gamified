<!DOCTYPE html>
{% load static %}
{% load filters %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Dashboard - {{ player.username }}</title>
  <link rel="stylesheet" href="{% static 'game/css/base.css' %}">
  <link rel="stylesheet" href="{% static 'game/css/dashboard.css' %}">
  <link rel="stylesheet" href="{% static 'game/libs/fontawesome/css/all.min.css' %}">
</head>
<body>

<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="animation-stack">
      <div class="text-base">LINUX</div>
      <style>
        @font-face {
          font-family: 'Brick Sans';
          src: url("{% static 'game/fonts/BrickSans-Bold.otf' %}") format('opentype');
          font-weight: bold;
          font-style: normal;
        }

        .text-base {
          font-family: 'Brick Sans', sans-serif;
          font-weight: bold;
        }
      </style>

      <pre id="trace"><span id="trace-chars"></span></pre>
    </div>
  </header>

  <main class="menu-section">
    <button onclick="location.href='{% url 'select_mode' %}'">
      <i class="fas fa-play"></i> Play Game
    </button>
    <button onclick="toggleModal('scoresModal')">
      <i class="fas fa-chart-line"></i> My Scores
    </button>
    <button onclick="toggleModal('leaderboardModal')">
      <i class="fas fa-list-ol"></i> Leaderboard
    </button>
    <button onclick="location.href='{% url 'logout' %}'">
      <i class="fas fa-sign-out-alt"></i> Exit
    </button>
  </main>
</div>

<!-- My Scores Modal -->
<div id="scoresModal" class="modal hidden">
  <div class="modal-content-score">
    <span class="close" onclick="toggleModal('scoresModal')">&times;</span>
    <h2>My Scores</h2>
    <div class="stat-item"><i class="fas fa-gamepad"></i> Games Played: {{ player.games_played }}</div>
    <div class="stat-item"><i class="fas fa-trophy"></i> Survival Score: {{ player.survival_score }}</div>
    <div class="stat-item"><i class="fas fa-clock"></i> Time Attack Score: {{ player.time_attack_score }}</div>
  </div>
</div>

<!-- Leaderboard Modal -->
<div id="leaderboardModal" class="modal hidden">
  <div class="modal-content scrollable">
    <span class="close" onclick="toggleModal('leaderboardModal')">&times;</span>
    <h2>Leaderboards</h2>

    <div class="leaderboard-tabs">
      <button class="tab-btn active" data-tab="overall">Overall</button>
      <button class="tab-btn" data-tab="survival">Survival</button>
      <button class="tab-btn" data-tab="time-attack">Time Attack</button>
      <button class="tab-btn" data-tab="hc-survival">Hardcore Survival</button>
      <button class="tab-btn" data-tab="hc-time-attack">Hardcore Time Attack</button>
    </div>

    <!-- Leaderboard sections (unchanged) -->
    <!-- ... all leaderboard content remains as-is ... -->
    {% comment %} The leaderboard tables remain unchanged from your version {% endcomment %}
  </div>
</div>

<script>
  function toggleModal(id) {
    document.getElementById(id).classList.toggle('hidden');
  }

  document.querySelectorAll('.tab-btn').forEach(button => {
    button.addEventListener('click', () => {
      const tab = button.getAttribute('data-tab');
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.leaderboard-box').forEach(box => box.classList.add('hidden'));
      button.classList.add('active');
      document.getElementById(tab).classList.remove('hidden');
    });
  });
</script>

<script src="{% static 'game/js/frames.js' %}"></script>
<script src="{% static 'game/js/fitTextToContainer.js' %}"></script>
<script>
  window.onload = function () {
    setPreCharSize();
    startAnimating();
    window.addEventListener('resize', setPreCharSize);
  };

  var pre = document.getElementById('trace');
  var i = -1;
  var dir = 'inc';
  var max = frames.length;
  var fps = 15;
  var fpsInterval, startTime, now, then, elapsed;

  function setPreCharSize() {
    var charRatio = 0.66;
    var charWidth = fitTextToContainer(frames[0].split('\n')[1], 'monospace', pre.clientWidth) * charRatio;
    var charHeight = charRatio * charWidth;
    pre.style.fontSize = charWidth + "px";
    pre.style.lineHeight = charHeight + "px";
  }

  function startAnimating() {
    fpsInterval = 1000 / fps;
    then = Date.now();
    startTime = then;
    animate();
  }

  function animate() {
    requestAnimationFrame(animate);
    now = Date.now();
    elapsed = now - then;

    if (elapsed > fpsInterval) {
      then = now - (elapsed % fpsInterval);
      step();
    }
  }

  function step() {
    if (dir === 'inc') {
      if (i === max - 1) {
        dir = 'dec';
        i--;
      } else {
        i++;
      }
    } else {
      if (i === 0) {
        dir = 'inc';
        i++;
      } else {
        i--;
      }
    }

    document.getElementById('trace-chars').innerText = frames[i];
  }
</script>

</body>
</html>
