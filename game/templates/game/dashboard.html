<!DOCTYPE html>
{% load static %}
{% load filters %}
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Game Dashboard - {{ player.username }}</title>
  <link rel="stylesheet" href="{% static 'game/css/base.css' %}">
  <link rel="stylesheet" href="{% static 'game/css/dashboard.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>HELLOOO</h1>
  </header>

  <main class="menu-section">
    <button onclick="location.href='{% url 'select_mode' %}'">
      <i class="fas fa-play"></i> Play Game
    </button>
    <button onclick="toggleModal('scoresModal')">
      <i class="fas fa-chart-line"></i> My Scores
    </button>
    <button onclick="toggleModal('leaderboardModal')">
      <i class="fas fa-list-ol"></i> Leaderboard
    </button>
    <button onclick="location.href='{% url 'logout' %}'">
      <i class="fas fa-sign-out-alt"></i> Exit
    </button>
  </main>
</div>

<!-- My Scores Modal -->
<div id="scoresModal" class="modal hidden">
  <div class="modal-content-score">
    <span class="close" onclick="toggleModal('scoresModal')">&times;</span>
    <h2>My Scores</h2>
    <div class="stat-item"><i class="fas fa-gamepad"></i> Games Played: {{ player.games_played }}</div>
    <div class="stat-item"><i class="fas fa-trophy"></i> Survival Score: {{ player.survival_score }}</div>
    <div class="stat-item"><i class="fas fa-clock"></i> Time Attack Score: {{ player.time_attack_score }}</div>
  </div>
</div>

<!-- Leaderboard Modal -->
<div id="leaderboardModal" class="modal hidden">
  <div class="modal-content scrollable">
    <span class="close" onclick="toggleModal('leaderboardModal')">&times;</span>
    <h2>Leaderboards</h2>

    <div class="leaderboard-tabs">
      <button class="tab-btn active" data-tab="overall">Overall</button>
      <button class="tab-btn" data-tab="survival">Survival</button>
      <button class="tab-btn" data-tab="time-attack">Time Attack</button>
      <button class="tab-btn" data-tab="hc-survival">Hardcore Survival</button>
      <button class="tab-btn" data-tab="hc-time-attack">Hardcore Time Attack</button>
    </div>

    <!-- Overall (comparison-style) -->
    <div id="overall" class="leaderboard-box active">
      <h3>Overall Leaderboard</h3>
      <table>
        <thead>
          <tr>
            <th>Rank</th>
            <th>Player</th>
            <th>Survival</th>
            <th>Time Attack</th>
            <th>HC Survival</th>
            <th>HC Time Attack</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in survival_leaderboard %}
          <tr class="{% if entry.username == player.username %}highlight-row{% endif %}">
            <td>{{ forloop.counter }}</td>
            <td>{{ entry.username }}</td>
            <td>{{ entry.survival_score }}</td>
            <td>
              {% for p in time_attack_leaderboard %}
                {% if p.username == entry.username %}{{ p.time_attack_score }}{% endif %}
              {% endfor %}
            </td>
            <td>
              {% for p in hardcore_survival_leaderboard %}
                {% if p.username == entry.username %}{{ p.ha_score }}{% endif %}
              {% endfor %}
            </td>
            <td>
              {% for p in hardcore_time_attack_leaderboard %}
                {% if p.username == entry.username %}{{ p.hta_score }}{% endif %}
              {% endfor %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Survival -->
    <div id="survival" class="leaderboard-box hidden">
      <h3>Survival Mode</h3>
      <table>
        <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
        <tbody>
          {% for entry in survival_leaderboard %}
          <tr class="{% if entry.username == player.username %}highlight-row{% endif %}">
            <td>{{ forloop.counter }}</td>
            <td>{{ entry.username }}</td>
            <td>{{ entry.survival_score }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Time Attack -->
    <div id="time-attack" class="leaderboard-box hidden">
      <h3>Time Attack Mode</h3>
      <table>
        <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
        <tbody>
          {% for entry in time_attack_leaderboard %}
          <tr class="{% if entry.username == player.username %}highlight-row{% endif %}">
            <td>{{ forloop.counter }}</td>
            <td>{{ entry.username }}</td>
            <td>{{ entry.time_attack_score }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- HC Survival -->
    <div id="hc-survival" class="leaderboard-box hidden">
      <h3>Hardcore Survival Mode</h3>
      <table>
        <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
        <tbody>
          {% for entry in hardcore_survival_leaderboard %}
          <tr class="{% if entry.username == player.username %}highlight-row{% endif %}">
            <td>{{ forloop.counter }}</td>
            <td>{{ entry.username }}</td>
            <td>{{ entry.ha_score }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- HC Time Attack -->
    <div id="hc-time-attack" class="leaderboard-box hidden">
      <h3>Hardcore Time Attack Mode</h3>
      <table>
        <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
        <tbody>
          {% for entry in hardcore_time_attack_leaderboard %}
          <tr class="{% if entry.username == player.username %}highlight-row{% endif %}">
            <td>{{ forloop.counter }}</td>
            <td>{{ entry.username }}</td>
            <td>{{ entry.hta_score }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
function toggleModal(id) {
  document.getElementById(id).classList.toggle('hidden');
}

document.querySelectorAll('.tab-btn').forEach(button => {
  button.addEventListener('click', () => {
    const tab = button.getAttribute('data-tab');

    // Remove "active" and "show" states from all buttons and boxes
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.leaderboard-box').forEach(box => box.classList.add('hidden'));

    // Activate the selected tab and show corresponding leaderboard
    button.classList.add('active');
    document.getElementById(tab).classList.remove('hidden');
  });
});
</script>


</body>
</html>
